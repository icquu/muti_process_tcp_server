每秒上下文切换多少次才算正常？
这个数值其实取决于系统本身的 CPU 性能
如果系统的上下文切换次数比较稳定，那么数百到一万以内，都是正常的
但当上下文切换次数超过一万次，或者切换次数出现数量级的增长时，就很可能已经出现了性能问题

深入分析
根据上下文切换的类型，具体分析

自愿上下文切换多了，说明进程都在等待资源，有可能发生了 I/O 等其他问题
非自愿上下文切换多了，说明进程都在被强制调度，也就是都在争抢 CPU，说明 CPU 的确成了瓶颈
中断次数变多了，说明 CPU 被中断处理程序占用，还需要通过 /pro/interrupts  文件来分析具体的中断类型

全文总结-如何查看分析上下文切换
通过 vmstat 确认系统的当前的上下文切换（cs）、中断次数（in）、就绪队列（r）、CPU 使用率（us、sy）
若上下文切换次数和 CPU 使用率过高，通过 pidstat 查看是哪个进程或线程的切换次数过高，CPU 使用率过高
然后确认是自愿上下文切换还是非自愿上下文切换，从而深入分析是否存在其他系统瓶颈问题
若中断次数过高，通过 /proc/interrupts 分析是哪种中断类型 

watch -d cat /proc/interrupts
pidstat -wt 1 10
pidstat -w -u 1
-w 输出进程切换指标，-u 输出 CPU 使用情况，可以看到 -t 参数
结果分析
cswch：每秒自愿上下文切换
nvcswch：每秒非自愿上下文切换的次数

自愿上下文切换
进程无法获取所需自愿，导致的上下文切换
栗子：I/O、内存等系统资源不足时，就会发生

非自愿上下文切换
非自愿上下文切换，则是指进程由于时间片已到等原因，被系统强制调度，进而发生的上下文切换
栗子：大量进程都在争抢 CPU 时，就容易发生非自愿上下文切换

第一个终端运行 sysbench
输入以下命令，以 10 个线程运行 5 分钟的基准测试，模拟多线程切换的问题

sysbench --threads=10 --time=300 threads run

第二个终端通过 vmstat 查看上下文切换
vmstat 1

结果分析
cs 列：上下文切换次数从之前 200 骤然上升到了 160w+...
r 列：就绪队列的长度最大到 8了，大于我们的 CPU 个数 4，所以会存在大量的 CPU 竞争
us、sy 列：两列的 CPU 使用率加起来上升到了 80-90，其中系统 CPU 使用率都是 60%+，说明 CPU 主要是被内核占用了
in 列：中断次数已经达到 8w 了...说明中断处理也是个潜在的问题

总结下
系统的就绪队列过长，也就是正在运行和等待 CPU 的进程数过多，导致了大量的上下文切换，而上下文切换又导致了 CPU 使用率升高
一环扣一环的，先有因后有果，别搞乱了顺序